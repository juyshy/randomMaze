<html>
<head>
<style>
#wrap  {
margin:50px auto;
width: 600px;
}
</style>

<script>
 
 /*
 http://www.physics.buffalo.edu/phy411-506/topic3/topic3-lec1.pdf
 // saw_agorithm_canvas_boundary_rajoitettuetsinta.html
 http://www.physics.buffalo.edu/phy411-506/topic3/sawalk.cpp
 
 saw_agorithm_canvas_boundary_rajoitettuetsinta_haarautumat.html
 
-haetaan random jo reitill‰ oleva piste, jolla on tyhj‰ vieress‰
 
 saw_agorithm_canvas_boundary_rajoitettuetsinta_haarautumat_02.html
 yritys: haetaan random tyhj‰ piste, joka on reitill‰ olevan pisteem vieress‰
 
 */
 
var dimesiot = 15;
 
var n_steps = (dimesiot+1)*(dimesiot+1)-100;
var boudaries = {xLeft:0, xRight:dimesiot, yTop:0, yBottom:dimesiot};
var startX = 0;
var startY = 0;	
var gridDim = 20;
var vapaat = [] ;
 
 var context ;

 function teeRuudukko() {
 		context.strokeStyle = "#8badb8";
		// s‰‰det‰‰n viivan leveys:
		context.lineWidth = 1;

		//context.beginPath();
		// ruudukko
 		for (var i = 0; i< 20; ++i) {
			context.moveTo(0, i*20); 
			context.lineTo(400, i*20);
			context.moveTo(i*20, 0);
			context.lineTo(i*20, 400);
		}
		context.stroke();
 }
 
	function piirraPallo( x,y,vari, lineWidth)  {
	context.beginPath();
		context.strokeStyle = vari || "#cc22bb" ;
		context.arc(  x*gridDim,y*gridDim, 4, 0, 2 * Math.PI, false);
		// context.fillStyle =  "#95b0f2"; // vari ;/* | "#95b082" */
		//context.fill();
		context.lineWidth = lineWidth || 3 ;
		context.stroke();
		context.closePath(); 
	}
 
  function vapaatAlussa() {
	var vapaatPisteet = [];
	for (var i = boudaries.xLeft ; i< boudaries.xRight; ++i) {
			for (var j = boudaries.yTop; j< boudaries.yBottom; ++j) {
			
			vapaatPisteet.push({ x:i , y:j });
	
		}
	}
	return vapaatPisteet;
  }
 
  function piirraPisteet(vapaat, vari, lineWidth) {
	for (var i = 0; i< vapaat.length; ++i) {
		piirraPallo(vapaat[i].x , vapaat[i].y ,vari, lineWidth);
	}
  }
 
 
   function poistaVapaista(piste) {
		for (var i = 0; i< vapaat.length; ++i) {
			if (piste.x == vapaat[i].x && piste.y == vapaat[i].y) {
				vapaat.splice(i,1);
				break;
			}
		}
   }
 
 function onVapaa(x, y, vapaat) {
				var  valid = false;
				// tarkastetaan on ko uusi satunnainen piste jo varattu
				
				for (var i = 0; i < vapaat.length; i++) {

				if ( x == vapaat[i].x && y == vapaat[i].y ) {
						valid = true;
						break; // jos on niin keskeytet‰‰n tarkistussilmukka
					}
				}
				return valid;
			}
			
 function mahdollisetUudetPisteet(x,y, vapaat) {
		var mahdolliset = []; 
		var right = x+1; // step East
		if ( onVapaa(right,y, vapaat)) mahdolliset.push({x:right, y:y});
		var down = y+1; // step North
		if (onVapaa(x,down, vapaat)) mahdolliset.push({x:x, y:down});
		var left  = x-1; // step West
		if ( onVapaa(left,y, vapaat)) mahdolliset.push({x:left, y:y});
		var up = y-1 ; // step South
		if ( onVapaa(x,up, vapaat)) mahdolliset.push({x:x, y:up});		  
		return mahdolliset;
	}
 
 function drawSawPath(startX, startY, sites) {
 
	context.beginPath();
	context.moveTo(startX, startY);

	for (var i = 0; i < sites.length; i++) {
		//console.log( "\n sites[" + i + "] x, y: " + sites[i].x + ", " + sites[i].y);

		context.lineTo(startX+ sites[i].x * 20 , startY+ sites[i].y * 20);
		context.stroke();
	} 
	context.closePath();
	 
 }
 
function drawSaw(context) {


	var vapaatInit = vapaatAlussa();

	vapaat = vapaatInit
	var siteGroups = []; 
	var alkupiste = { x:0 , y:0 };
	poistaVapaista(alkupiste);
	var s ={};


	
	
	function stepPoints(alkupiste) {
	var sites = []; // set of occupied lattice sites
	s.x = alkupiste.x;
	s.y = alkupiste.y;
/* 	if (pisteOnListassa(alkupiste,sites) {
	sites.push({x:s.x , y:s.y });
	} */
	
	
	
	//piirraPisteet(vapaat);
	
	var walk_failed = false;
	for (var step = 0; step < n_steps; step++) {
		
		var mahdolliset = mahdollisetUudetPisteet(s.x, s.y, vapaat);
		//piirraPisteet(mahdolliset,  "#95b0f2",4);
		if (mahdolliset.length > 0) {
            var d = Math.floor(Math.random()*mahdolliset.length);
            // console.log( " std_rand = " + d  );
			// luodaan uusi satunnainen piste
			
			s= mahdolliset[d];
			poistaVapaista(s);
			} else { // jos step ei onnistunut   keskeytet‰‰n steps loop
            walk_failed = true;
			//console.log( " walk_failed = " + walk_failed  );
            break;
            }
			//console.log( "sites.push(s); = " + s.x + " " + s.y  );
            sites.push({ x:s.x , y:s.y });
	}
	return sites;
	}
	
  	function kaikkiReitillaJoillaVapaaVieressa(vapaat, sites) {
		var mahdolliset_haarautuvat = []
		for (var i = 0; i < sites.length ; i++) {
/* 		console.log(" sites[i].x " + sites[i].x); */
			var reitinvieressaOlevatPisteet= mahdollisetUudetPisteet(sites[i].x, sites[i].y, vapaat);
			for (var j= 0; j<reitinvieressaOlevatPisteet.length ; j++) {
				for (var k= 0; k<vapaat.length ; k++) {
					if (reitinvieressaOlevatPisteet[j].x == vapaat[k].x && reitinvieressaOlevatPisteet[j].y == vapaat[k].y) {
						mahdolliset_haarautuvat.push(sites[i]);
					}
					
				}
			}	
		}
		return mahdolliset_haarautuvat;
	}
	
	function haarautumanAlku(vapaat, sites) {
	
	var valmiitHaarautumaan= kaikkiReitillaJoillaVapaaVieressa(vapaat, sites);
	piirraPisteet(valmiitHaarautumaan);
	var randindx = Math.floor(Math.random() * valmiitHaarautumaan.length);
	return valmiitHaarautumaan[randindx];
	}

	
/* 	while (vapaat.length > 0) { */
	var sites = stepPoints(alkupiste);
	context.strokeStyle = "#121212";
	context.lineWidth = 3;
	drawSawPath(startX, startY, sites);//,  "#050002",4);
	
	alkupiste = haarautumanAlku(vapaat, sites);
	piirraPallo( alkupiste.x , alkupiste.y ,"#ff3300",5) 
	
	
	
/*  	var sites2= stepPoints(alkupiste);
 	context.strokeStyle = "#121212";
	context.lineWidth = 3;
	drawSawPath(alkupiste.x, alkupiste.y, sites2);//,   "#050002",4); */ /*  */
/* 	} */

	
	
}
 
 
 window.onload = function(){
		// haetaan muuttujaan viite DOM canvas elementtiin id:n perusteella
		var canvas = document.getElementById("canvakseniMun");
		// luodaan 2d piirtokonteksti canvas objektin getContext() methodilla
		context = canvas.getContext("2d");	
		teeRuudukko();
		drawSaw(context);
	};
 
 // http://www.physics.buffalo.edu/phy411-506/topic3/topic3-lec1.pdf

</script>
</head>
<body>
<div id="wrap">
	<canvas id="canvakseniMun" width="400" height="400" style="border:1px solid black;">
	</canvas>
	</div>
</body>
</html>
